name: Check Challenge Indexes

on:
  pull_request:
    paths:
      - 'challenges/**'

jobs:
  check-index:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies
      run: pip install pyyaml

    - name: Check for duplicate indexes
      run: |
        python - << 'EOF'
        import os
        import json
        import collections

        challenges_dir = "challenges"
        seen_indexes = set()
        questions = collections.defaultdict(list)
        for folder in os.listdir(challenges_dir):
            folder_path = os.path.join(challenges_dir, folder)
            for question in os.listdir(folder_path):
                idx = question.split("_")[0]
                questions[idx].append(question)

        is_duplicate = False
        for k, v in questions.items():
            if len(v) > 1:
                print("Duplicate Questions: ")
                [print(i) for i in v]
                is_duplicate = True

        if is_duplicate:
            exit(1)
        else:
            print("âœ… All indexes are unique.")
        EOF